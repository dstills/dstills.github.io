"use strict";
(self["webpackChunksynview"] = self["webpackChunksynview"] || []).push([["vendors-node_modules_esri_calcite-components_dist_components_shared-list-render_js"],{

/***/ "./node_modules/@esri/calcite-components/dist/components/resources3.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/components/resources3.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS),
/* harmony export */   I: () => (/* binding */ ICON_TYPES),
/* harmony export */   S: () => (/* binding */ SLOTS)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.7.0
 */
const CSS = {
  sticky: "sticky-pos",
};
var ICON_TYPES;
(function (ICON_TYPES) {
  ICON_TYPES["circle"] = "circle";
  ICON_TYPES["square"] = "square";
  ICON_TYPES["grip"] = "grip";
})(ICON_TYPES || (ICON_TYPES = {}));
const SLOTS = {
  menuActions: "menu-actions",
};




/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/components/resources4.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/components/resources4.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS),
/* harmony export */   S: () => (/* binding */ SLOTS)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.7.0
 */
const CSS = {
  heading: "heading",
  container: "container",
  indented: "container--indented",
};
const SLOTS = {
  parentItem: "parent-item",
};




/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/components/shared-list-render.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/components/shared-list-render.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   L: () => (/* binding */ List),
/* harmony export */   a: () => (/* binding */ deselectSiblingItems),
/* harmony export */   b: () => (/* binding */ handleFilterEvent),
/* harmony export */   c: () => (/* binding */ initializeObserver),
/* harmony export */   d: () => (/* binding */ deselectRemovedItems),
/* harmony export */   e: () => (/* binding */ cleanUpObserver),
/* harmony export */   f: () => (/* binding */ handleInitialFilter),
/* harmony export */   g: () => (/* binding */ getItemData),
/* harmony export */   h: () => (/* binding */ handleFilter),
/* harmony export */   i: () => (/* binding */ initialize),
/* harmony export */   j: () => (/* binding */ calciteListItemChangeHandler),
/* harmony export */   k: () => (/* binding */ keyDownHandler),
/* harmony export */   l: () => (/* binding */ calciteInternalListItemValueChangeHandler),
/* harmony export */   m: () => (/* binding */ mutationObserverCallback),
/* harmony export */   n: () => (/* binding */ calciteListFocusOutHandler),
/* harmony export */   o: () => (/* binding */ setUpItems),
/* harmony export */   p: () => (/* binding */ setFocus),
/* harmony export */   q: () => (/* binding */ getItemIndex),
/* harmony export */   r: () => (/* binding */ removeItem),
/* harmony export */   s: () => (/* binding */ selectSiblings),
/* harmony export */   t: () => (/* binding */ moveItemIndex)
/* harmony export */ });
/* harmony import */ var _array_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./array.js */ "./node_modules/@esri/calcite-components/dist/components/array.js");
/* harmony import */ var _dom_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom.js */ "./node_modules/@esri/calcite-components/dist/components/dom.js");
/* harmony import */ var _resources4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./resources4.js */ "./node_modules/@esri/calcite-components/dist/components/resources4.js");
/* harmony import */ var _debounce_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./debounce.js */ "./node_modules/@esri/calcite-components/dist/components/debounce.js");
/* harmony import */ var _stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @stencil/core/internal/client/index.js */ "./node_modules/@stencil/core/internal/client/index.js");
/* harmony import */ var _resources3_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./resources3.js */ "./node_modules/@esri/calcite-components/dist/components/resources3.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.7.0
 */







function mutationObserverCallback() {
  this.setUpItems();
  this.setUpFilter();
  this.deselectRemovedItems();
}
const SUPPORTED_ARROW_KEYS = ["ArrowUp", "ArrowDown"];
// --------------------------------------------------------------------------
//
//  Lifecycle
//
// --------------------------------------------------------------------------
function initialize() {
  this.setUpItems();
  this.setUpFilter();
  this.emitCalciteListChange = (0,_debounce_js__WEBPACK_IMPORTED_MODULE_3__.d)(internalCalciteListChangeEvent.bind(this), 0);
  this.emitCalciteListFilter = (0,_debounce_js__WEBPACK_IMPORTED_MODULE_3__.d)(internalCalciteListFilterEvent.bind(this), 0);
}
function initializeObserver() {
  this.mutationObserver?.observe(this.el, { childList: true, subtree: true });
}
function cleanUpObserver() {
  this.mutationObserver?.disconnect();
}
// --------------------------------------------------------------------------
//
//  Listeners
//
// --------------------------------------------------------------------------
function calciteListItemChangeHandler(event) {
  const { selectedValues } = this;
  const { item, value, selected, shiftPressed } = event.detail;
  if (selected) {
    if (this.multiple && shiftPressed) {
      this.selectSiblings(item);
    }
    if (!this.multiple) {
      this.deselectSiblingItems(item);
    }
    selectedValues.set(value, item);
  }
  else {
    selectedValues.delete(value);
    if (this.multiple && shiftPressed) {
      this.selectSiblings(item, true);
    }
  }
  if (!this.multiple) {
    toggleSingleSelectItemTabbing(item, selected);
    if (selected) {
      (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.k)(item);
    }
  }
  this.lastSelectedItem = item;
  this.emitCalciteListChange();
}
function calciteInternalListItemValueChangeHandler(event) {
  const oldValue = event.detail.oldValue;
  const selectedValues = this.selectedValues;
  if (selectedValues.has(oldValue)) {
    const item = selectedValues.get(oldValue);
    selectedValues.delete(oldValue);
    selectedValues.set(event.detail.newValue, item);
  }
  event.stopPropagation();
}
// --------------------------------------------------------------------------
//
//  Private Methods
//
// --------------------------------------------------------------------------
function isValidNavigationKey(key) {
  return !!SUPPORTED_ARROW_KEYS.find((k) => k === key);
}
function calciteListFocusOutHandler(event) {
  const { el, items, multiple, selectedValues } = this;
  if (multiple) {
    return;
  }
  const focusedInside = el.contains(event.relatedTarget);
  if (focusedInside) {
    return;
  }
  filterOutDisabled(items).forEach((item) => {
    toggleSingleSelectItemTabbing(item, selectedValues.size === 0 ? item.contains(event.target) || event.target === item : item.selected);
  });
}
function keyDownHandler(event) {
  const { key, target } = event;
  if (!isValidNavigationKey(key)) {
    return;
  }
  const { items, multiple, selectionFollowsFocus } = this;
  const { length: totalItems } = items;
  const currentIndex = items.indexOf(target);
  if (!totalItems || currentIndex === -1) {
    return;
  }
  event.preventDefault();
  const index = moveItemIndex(this, target, key === "ArrowUp" ? "up" : "down");
  const item = items[index];
  items.forEach((i) => toggleSingleSelectItemTabbing(i, i === item));
  if (!multiple && selectionFollowsFocus) {
    item.selected = true;
  }
  (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.k)(item);
}
function moveItemIndex(list, item, direction) {
  const { items } = list;
  const { length: totalItems } = items;
  const currentIndex = items.indexOf(item);
  const directionFactor = direction === "up" ? -1 : 1;
  let moveOffset = 1;
  let index = (0,_array_js__WEBPACK_IMPORTED_MODULE_0__.g)(currentIndex + directionFactor * moveOffset++, totalItems);
  const firstMovedIndex = index;
  while (items[index].disabled) {
    index = (0,_array_js__WEBPACK_IMPORTED_MODULE_0__.g)(currentIndex + directionFactor * moveOffset++, totalItems);
    if (index === firstMovedIndex) {
      break;
    }
  }
  return index;
}
function getItemIndex(list, item) {
  const { items } = list;
  return items.indexOf(item);
}
function filterOutDisabled(items) {
  return items.filter((item) => !item.disabled);
}
function internalCalciteListFilterEvent() {
  this.calciteListFilter.emit();
}
function internalCalciteListChangeEvent() {
  this.calciteListChange.emit(this.selectedValues);
}
function removeItem(event) {
  if (event.defaultPrevented) {
    return;
  }
  const item = event.target;
  const selectedValues = this.selectedValues;
  if (item.parentElement.tagName === "CALCITE-PICK-LIST-GROUP" && item.slot === _resources4_js__WEBPACK_IMPORTED_MODULE_2__.S.parentItem) {
    item.parentElement.remove();
    Array.from(item.parentElement.children).forEach((item) => selectedValues.delete(item.value));
  }
  else {
    item.remove();
    selectedValues.delete(item.value);
  }
  this.emitCalciteListChange();
}
function toggleSingleSelectItemTabbing(item, selectable) {
  if (item.disabled) {
    return;
  }
  // using attribute intentionally
  if (selectable) {
    item.removeAttribute("tabindex");
  }
  else {
    item.setAttribute("tabindex", "-1");
  }
}
async function setFocus(focusId) {
  if (this.filterEnabled && focusId === "filter") {
    await (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.k)(this.filterEl);
    return;
  }
  const { items, multiple, selectionFollowsFocus } = this;
  if (items.length === 0) {
    return;
  }
  if (multiple) {
    return filterOutDisabled(items)[0]?.setFocus();
  }
  const filtered = filterOutDisabled(items);
  const focusTarget = filtered.find((item) => item.selected) || filtered[0];
  if (selectionFollowsFocus && focusTarget) {
    focusTarget.selected = true;
  }
  return focusTarget.setFocus();
}
function setUpItems(tagName) {
  this.items = Array.from(this.el.querySelectorAll(tagName));
  let hasSelected = false;
  const { items } = this;
  items.forEach((item) => {
    item.icon = this.getIconType();
    if (!this.multiple) {
      item.deselectDisabled = true;
      toggleSingleSelectItemTabbing(item, false);
    }
    if (item.selected) {
      hasSelected = true;
      toggleSingleSelectItemTabbing(item, true);
      this.selectedValues.set(item.value, item);
    }
  });
  const [first] = items;
  if (!hasSelected && first && !first.disabled) {
    toggleSingleSelectItemTabbing(first, true);
  }
}
function deselectRemovedItems() {
  const selectedValues = this.selectedValues;
  const itemValues = this.items.map(({ value }) => value);
  selectedValues.forEach((selectedItem) => {
    if (!itemValues.includes(selectedItem.value)) {
      this.selectedValues.delete(selectedItem.value);
    }
  });
}
function deselectSiblingItems(item) {
  this.items.forEach((currentItem) => {
    if (currentItem.value !== item.value) {
      currentItem.toggleSelected(false);
      if (this.selectedValues.has(currentItem.value)) {
        this.selectedValues.delete(currentItem.value);
      }
    }
  });
}
function selectSiblings(item, deselect = false) {
  if (!this.lastSelectedItem) {
    return;
  }
  const { items } = this;
  const start = items.findIndex((currentItem) => {
    return currentItem.value === this.lastSelectedItem.value;
  });
  const end = items.findIndex((currentItem) => {
    return currentItem.value === item.value;
  });
  items.slice(Math.min(start, end), Math.max(start, end)).forEach((currentItem) => {
    currentItem.toggleSelected(!deselect);
    if (!deselect) {
      this.selectedValues.set(currentItem.value, currentItem);
    }
    else {
      this.selectedValues.delete(currentItem.value);
    }
  });
}
let groups;
function handleFilter(emit = false) {
  const { filteredData, filterText } = this;
  const values = filteredData.map((item) => item.value);
  let hasSelectedMatch = false;
  if (!groups) {
    groups = new Set();
  }
  const matchedItems = this.items?.filter((item) => {
    const parent = item.parentElement;
    const grouped = parent.matches("calcite-pick-list-group");
    if (grouped) {
      groups.add(parent);
    }
    const matches = filterText ? values.includes(item.value) : true;
    item.hidden = !matches;
    if (!hasSelectedMatch) {
      hasSelectedMatch = matches && item.selected;
    }
    return matches;
  }) || [];
  groups.forEach((group) => {
    const hasAtLeastOneMatch = matchedItems.some((item) => group.contains(item));
    group.hidden = !hasAtLeastOneMatch;
    if (!hasAtLeastOneMatch) {
      return;
    }
    const parentItem = (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.g)(group, "parent-item");
    if (parentItem) {
      parentItem.hidden = false;
      if (matchedItems.includes(parentItem)) {
        Array.from(group.children).forEach((child) => (child.hidden = false));
      }
    }
  });
  groups.clear();
  if (matchedItems.length > 0 && !hasSelectedMatch && !this.multiple) {
    toggleSingleSelectItemTabbing(matchedItems[0], true);
  }
  this.setFilteredItems(matchedItems);
  if (emit) {
    this.emitCalciteListFilter();
  }
}
function handleInitialFilter() {
  const filteredItems = this.filterEl?.filteredItems;
  if (filteredItems) {
    this.filteredData = filteredItems;
  }
  this.handleFilter();
}
function handleFilterEvent(event) {
  event.stopPropagation();
  const { filteredItems, value } = event.currentTarget;
  this.filterText = value;
  this.filteredData = filteredItems;
  this.handleFilter(true);
}
function getItemData() {
  return this.items.map((item) => ({
    label: item.label,
    description: item.description,
    metadata: item.metadata,
    value: item.value,
  }));
}

const List = ({ props: { disabled, loading, filterEnabled, dataForFilter, handleFilterEvent, filterPlaceholder, filterText, setFilterEl, dragEnabled, storeAssistiveEl, }, ...rest }) => {
  const defaultSlot = (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("slot", null);
  return ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)(_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.Host, { "aria-busy": (0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.t)(loading), role: "menu", ...rest },
    (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("section", null,
      dragEnabled ? ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("span", { "aria-live": "assertive", class: "assistive-text", 
        // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
        ref: storeAssistiveEl })) : null,
      (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("header", { class: { [_resources3_js__WEBPACK_IMPORTED_MODULE_4__.C.sticky]: true } },
        filterEnabled ? ((0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("calcite-filter", { "aria-label": filterPlaceholder, disabled: loading || disabled, items: dataForFilter, onCalciteFilterChange: handleFilterEvent, placeholder: filterPlaceholder, value: filterText, 
          // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
          ref: setFilterEl })) : null,
        (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("slot", { name: _resources3_js__WEBPACK_IMPORTED_MODULE_4__.S.menuActions })),
      loading ? (0,_stencil_core_internal_client_index_js__WEBPACK_IMPORTED_MODULE_5__.h)("calcite-scrim", { loading: loading }) : null,
      defaultSlot)));
};




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfZXNyaV9jYWxjaXRlLWNvbXBvbmVudHNfZGlzdF9jb21wb25lbnRzX3NoYXJlZC1saXN0LXJlbmRlcl9qcy5idW5kbGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGdDQUFnQztBQUNqQztBQUNBO0FBQ0E7O0FBRWlEOzs7Ozs7Ozs7Ozs7Ozs7O0FDbEJqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFZ0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDZGhDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDcUQ7QUFDNkI7QUFDckM7QUFDQztBQUNtQjtBQUNSOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLCtDQUFRO0FBQ3ZDLCtCQUErQiwrQ0FBUTtBQUN2QztBQUNBO0FBQ0EsNENBQTRDLGdDQUFnQztBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsaUJBQWlCO0FBQzNCLFVBQVUsc0NBQXNDO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sMENBQVk7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxz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ZWJwYWNrOi8vc3ludmlldy8uL25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvZGlzdC9jb21wb25lbnRzL3Jlc291cmNlczMuanMiLCJ3ZWJwYWNrOi8vc3ludmlldy8uL25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvZGlzdC9jb21wb25lbnRzL3Jlc291cmNlczQuanMiLCJ3ZWJwYWNrOi8vc3ludmlldy8uL25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvZGlzdC9jb21wb25lbnRzL3NoYXJlZC1saXN0LXJlbmRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL2Jsb2IvbWFpbi9MSUNFTlNFLm1kIGZvciBkZXRhaWxzLlxuICogdjEuNy4wXG4gKi9cbmNvbnN0IENTUyA9IHtcbiAgc3RpY2t5OiBcInN0aWNreS1wb3NcIixcbn07XG52YXIgSUNPTl9UWVBFUztcbihmdW5jdGlvbiAoSUNPTl9UWVBFUykge1xuICBJQ09OX1RZUEVTW1wiY2lyY2xlXCJdID0gXCJjaXJjbGVcIjtcbiAgSUNPTl9UWVBFU1tcInNxdWFyZVwiXSA9IFwic3F1YXJlXCI7XG4gIElDT05fVFlQRVNbXCJncmlwXCJdID0gXCJncmlwXCI7XG59KShJQ09OX1RZUEVTIHx8IChJQ09OX1RZUEVTID0ge30pKTtcbmNvbnN0IFNMT1RTID0ge1xuICBtZW51QWN0aW9uczogXCJtZW51LWFjdGlvbnNcIixcbn07XG5cbmV4cG9ydCB7IENTUyBhcyBDLCBJQ09OX1RZUEVTIGFzIEksIFNMT1RTIGFzIFMgfTtcbiIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vYmxvYi9tYWluL0xJQ0VOU0UubWQgZm9yIGRldGFpbHMuXG4gKiB2MS43LjBcbiAqL1xuY29uc3QgQ1NTID0ge1xuICBoZWFkaW5nOiBcImhlYWRpbmdcIixcbiAgY29udGFpbmVyOiBcImNvbnRhaW5lclwiLFxuICBpbmRlbnRlZDogXCJjb250YWluZXItLWluZGVudGVkXCIsXG59O1xuY29uc3QgU0xPVFMgPSB7XG4gIHBhcmVudEl0ZW06IFwicGFyZW50LWl0ZW1cIixcbn07XG5cbmV4cG9ydCB7IENTUyBhcyBDLCBTTE9UUyBhcyBTIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL2Jsb2IvbWFpbi9MSUNFTlNFLm1kIGZvciBkZXRhaWxzLlxuICogdjEuNy4wXG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0Um91bmRSb2JpbkluZGV4IH0gZnJvbSAnLi9hcnJheS5qcyc7XG5pbXBvcnQgeyBrIGFzIGZvY3VzRWxlbWVudCwgZyBhcyBnZXRTbG90dGVkLCB0IGFzIHRvQXJpYUJvb2xlYW4gfSBmcm9tICcuL2RvbS5qcyc7XG5pbXBvcnQgeyBTIGFzIFNMT1RTIH0gZnJvbSAnLi9yZXNvdXJjZXM0LmpzJztcbmltcG9ydCB7IGQgYXMgZGVib3VuY2UgfSBmcm9tICcuL2RlYm91bmNlLmpzJztcbmltcG9ydCB7IGgsIEhvc3QgfSBmcm9tICdAc3RlbmNpbC9jb3JlL2ludGVybmFsL2NsaWVudC9pbmRleC5qcyc7XG5pbXBvcnQgeyBDIGFzIENTUywgUyBhcyBTTE9UUyQxIH0gZnJvbSAnLi9yZXNvdXJjZXMzLmpzJztcblxuZnVuY3Rpb24gbXV0YXRpb25PYnNlcnZlckNhbGxiYWNrKCkge1xuICB0aGlzLnNldFVwSXRlbXMoKTtcbiAgdGhpcy5zZXRVcEZpbHRlcigpO1xuICB0aGlzLmRlc2VsZWN0UmVtb3ZlZEl0ZW1zKCk7XG59XG5jb25zdCBTVVBQT1JURURfQVJST1dfS0VZUyA9IFtcIkFycm93VXBcIiwgXCJBcnJvd0Rvd25cIl07XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9cbi8vICBMaWZlY3ljbGVcbi8vXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgdGhpcy5zZXRVcEl0ZW1zKCk7XG4gIHRoaXMuc2V0VXBGaWx0ZXIoKTtcbiAgdGhpcy5lbWl0Q2FsY2l0ZUxpc3RDaGFuZ2UgPSBkZWJvdW5jZShpbnRlcm5hbENhbGNpdGVMaXN0Q2hhbmdlRXZlbnQuYmluZCh0aGlzKSwgMCk7XG4gIHRoaXMuZW1pdENhbGNpdGVMaXN0RmlsdGVyID0gZGVib3VuY2UoaW50ZXJuYWxDYWxjaXRlTGlzdEZpbHRlckV2ZW50LmJpbmQodGhpcyksIDApO1xufVxuZnVuY3Rpb24gaW5pdGlhbGl6ZU9ic2VydmVyKCkge1xuICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXI/Lm9ic2VydmUodGhpcy5lbCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7XG59XG5mdW5jdGlvbiBjbGVhblVwT2JzZXJ2ZXIoKSB7XG4gIHRoaXMubXV0YXRpb25PYnNlcnZlcj8uZGlzY29ubmVjdCgpO1xufVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vXG4vLyAgTGlzdGVuZXJzXG4vL1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmZ1bmN0aW9uIGNhbGNpdGVMaXN0SXRlbUNoYW5nZUhhbmRsZXIoZXZlbnQpIHtcbiAgY29uc3QgeyBzZWxlY3RlZFZhbHVlcyB9ID0gdGhpcztcbiAgY29uc3QgeyBpdGVtLCB2YWx1ZSwgc2VsZWN0ZWQsIHNoaWZ0UHJlc3NlZCB9ID0gZXZlbnQuZGV0YWlsO1xuICBpZiAoc2VsZWN0ZWQpIHtcbiAgICBpZiAodGhpcy5tdWx0aXBsZSAmJiBzaGlmdFByZXNzZWQpIHtcbiAgICAgIHRoaXMuc2VsZWN0U2libGluZ3MoaXRlbSk7XG4gICAgfVxuICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgdGhpcy5kZXNlbGVjdFNpYmxpbmdJdGVtcyhpdGVtKTtcbiAgICB9XG4gICAgc2VsZWN0ZWRWYWx1ZXMuc2V0KHZhbHVlLCBpdGVtKTtcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxlY3RlZFZhbHVlcy5kZWxldGUodmFsdWUpO1xuICAgIGlmICh0aGlzLm11bHRpcGxlICYmIHNoaWZ0UHJlc3NlZCkge1xuICAgICAgdGhpcy5zZWxlY3RTaWJsaW5ncyhpdGVtLCB0cnVlKTtcbiAgICB9XG4gIH1cbiAgaWYgKCF0aGlzLm11bHRpcGxlKSB7XG4gICAgdG9nZ2xlU2luZ2xlU2VsZWN0SXRlbVRhYmJpbmcoaXRlbSwgc2VsZWN0ZWQpO1xuICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgZm9jdXNFbGVtZW50KGl0ZW0pO1xuICAgIH1cbiAgfVxuICB0aGlzLmxhc3RTZWxlY3RlZEl0ZW0gPSBpdGVtO1xuICB0aGlzLmVtaXRDYWxjaXRlTGlzdENoYW5nZSgpO1xufVxuZnVuY3Rpb24gY2FsY2l0ZUludGVybmFsTGlzdEl0ZW1WYWx1ZUNoYW5nZUhhbmRsZXIoZXZlbnQpIHtcbiAgY29uc3Qgb2xkVmFsdWUgPSBldmVudC5kZXRhaWwub2xkVmFsdWU7XG4gIGNvbnN0IHNlbGVjdGVkVmFsdWVzID0gdGhpcy5zZWxlY3RlZFZhbHVlcztcbiAgaWYgKHNlbGVjdGVkVmFsdWVzLmhhcyhvbGRWYWx1ZSkpIHtcbiAgICBjb25zdCBpdGVtID0gc2VsZWN0ZWRWYWx1ZXMuZ2V0KG9sZFZhbHVlKTtcbiAgICBzZWxlY3RlZFZhbHVlcy5kZWxldGUob2xkVmFsdWUpO1xuICAgIHNlbGVjdGVkVmFsdWVzLnNldChldmVudC5kZXRhaWwubmV3VmFsdWUsIGl0ZW0pO1xuICB9XG4gIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xufVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vXG4vLyAgUHJpdmF0ZSBNZXRob2RzXG4vL1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmZ1bmN0aW9uIGlzVmFsaWROYXZpZ2F0aW9uS2V5KGtleSkge1xuICByZXR1cm4gISFTVVBQT1JURURfQVJST1dfS0VZUy5maW5kKChrKSA9PiBrID09PSBrZXkpO1xufVxuZnVuY3Rpb24gY2FsY2l0ZUxpc3RGb2N1c091dEhhbmRsZXIoZXZlbnQpIHtcbiAgY29uc3QgeyBlbCwgaXRlbXMsIG11bHRpcGxlLCBzZWxlY3RlZFZhbHVlcyB9ID0gdGhpcztcbiAgaWYgKG11bHRpcGxlKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGZvY3VzZWRJbnNpZGUgPSBlbC5jb250YWlucyhldmVudC5yZWxhdGVkVGFyZ2V0KTtcbiAgaWYgKGZvY3VzZWRJbnNpZGUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZmlsdGVyT3V0RGlzYWJsZWQoaXRlbXMpLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICB0b2dnbGVTaW5nbGVTZWxlY3RJdGVtVGFiYmluZyhpdGVtLCBzZWxlY3RlZFZhbHVlcy5zaXplID09PSAwID8gaXRlbS5jb250YWlucyhldmVudC50YXJnZXQpIHx8IGV2ZW50LnRhcmdldCA9PT0gaXRlbSA6IGl0ZW0uc2VsZWN0ZWQpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGtleURvd25IYW5kbGVyKGV2ZW50KSB7XG4gIGNvbnN0IHsga2V5LCB0YXJnZXQgfSA9IGV2ZW50O1xuICBpZiAoIWlzVmFsaWROYXZpZ2F0aW9uS2V5KGtleSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgeyBpdGVtcywgbXVsdGlwbGUsIHNlbGVjdGlvbkZvbGxvd3NGb2N1cyB9ID0gdGhpcztcbiAgY29uc3QgeyBsZW5ndGg6IHRvdGFsSXRlbXMgfSA9IGl0ZW1zO1xuICBjb25zdCBjdXJyZW50SW5kZXggPSBpdGVtcy5pbmRleE9mKHRhcmdldCk7XG4gIGlmICghdG90YWxJdGVtcyB8fCBjdXJyZW50SW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGluZGV4ID0gbW92ZUl0ZW1JbmRleCh0aGlzLCB0YXJnZXQsIGtleSA9PT0gXCJBcnJvd1VwXCIgPyBcInVwXCIgOiBcImRvd25cIik7XG4gIGNvbnN0IGl0ZW0gPSBpdGVtc1tpbmRleF07XG4gIGl0ZW1zLmZvckVhY2goKGkpID0+IHRvZ2dsZVNpbmdsZVNlbGVjdEl0ZW1UYWJiaW5nKGksIGkgPT09IGl0ZW0pKTtcbiAgaWYgKCFtdWx0aXBsZSAmJiBzZWxlY3Rpb25Gb2xsb3dzRm9jdXMpIHtcbiAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgfVxuICBmb2N1c0VsZW1lbnQoaXRlbSk7XG59XG5mdW5jdGlvbiBtb3ZlSXRlbUluZGV4KGxpc3QsIGl0ZW0sIGRpcmVjdGlvbikge1xuICBjb25zdCB7IGl0ZW1zIH0gPSBsaXN0O1xuICBjb25zdCB7IGxlbmd0aDogdG90YWxJdGVtcyB9ID0gaXRlbXM7XG4gIGNvbnN0IGN1cnJlbnRJbmRleCA9IGl0ZW1zLmluZGV4T2YoaXRlbSk7XG4gIGNvbnN0IGRpcmVjdGlvbkZhY3RvciA9IGRpcmVjdGlvbiA9PT0gXCJ1cFwiID8gLTEgOiAxO1xuICBsZXQgbW92ZU9mZnNldCA9IDE7XG4gIGxldCBpbmRleCA9IGdldFJvdW5kUm9iaW5JbmRleChjdXJyZW50SW5kZXggKyBkaXJlY3Rpb25GYWN0b3IgKiBtb3ZlT2Zmc2V0KyssIHRvdGFsSXRlbXMpO1xuICBjb25zdCBmaXJzdE1vdmVkSW5kZXggPSBpbmRleDtcbiAgd2hpbGUgKGl0ZW1zW2luZGV4XS5kaXNhYmxlZCkge1xuICAgIGluZGV4ID0gZ2V0Um91bmRSb2JpbkluZGV4KGN1cnJlbnRJbmRleCArIGRpcmVjdGlvbkZhY3RvciAqIG1vdmVPZmZzZXQrKywgdG90YWxJdGVtcyk7XG4gICAgaWYgKGluZGV4ID09PSBmaXJzdE1vdmVkSW5kZXgpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaW5kZXg7XG59XG5mdW5jdGlvbiBnZXRJdGVtSW5kZXgobGlzdCwgaXRlbSkge1xuICBjb25zdCB7IGl0ZW1zIH0gPSBsaXN0O1xuICByZXR1cm4gaXRlbXMuaW5kZXhPZihpdGVtKTtcbn1cbmZ1bmN0aW9uIGZpbHRlck91dERpc2FibGVkKGl0ZW1zKSB7XG4gIHJldHVybiBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+ICFpdGVtLmRpc2FibGVkKTtcbn1cbmZ1bmN0aW9uIGludGVybmFsQ2FsY2l0ZUxpc3RGaWx0ZXJFdmVudCgpIHtcbiAgdGhpcy5jYWxjaXRlTGlzdEZpbHRlci5lbWl0KCk7XG59XG5mdW5jdGlvbiBpbnRlcm5hbENhbGNpdGVMaXN0Q2hhbmdlRXZlbnQoKSB7XG4gIHRoaXMuY2FsY2l0ZUxpc3RDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkVmFsdWVzKTtcbn1cbmZ1bmN0aW9uIHJlbW92ZUl0ZW0oZXZlbnQpIHtcbiAgaWYgKGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaXRlbSA9IGV2ZW50LnRhcmdldDtcbiAgY29uc3Qgc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLnNlbGVjdGVkVmFsdWVzO1xuICBpZiAoaXRlbS5wYXJlbnRFbGVtZW50LnRhZ05hbWUgPT09IFwiQ0FMQ0lURS1QSUNLLUxJU1QtR1JPVVBcIiAmJiBpdGVtLnNsb3QgPT09IFNMT1RTLnBhcmVudEl0ZW0pIHtcbiAgICBpdGVtLnBhcmVudEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgQXJyYXkuZnJvbShpdGVtLnBhcmVudEVsZW1lbnQuY2hpbGRyZW4pLmZvckVhY2goKGl0ZW0pID0+IHNlbGVjdGVkVmFsdWVzLmRlbGV0ZShpdGVtLnZhbHVlKSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaXRlbS5yZW1vdmUoKTtcbiAgICBzZWxlY3RlZFZhbHVlcy5kZWxldGUoaXRlbS52YWx1ZSk7XG4gIH1cbiAgdGhpcy5lbWl0Q2FsY2l0ZUxpc3RDaGFuZ2UoKTtcbn1cbmZ1bmN0aW9uIHRvZ2dsZVNpbmdsZVNlbGVjdEl0ZW1UYWJiaW5nKGl0ZW0sIHNlbGVjdGFibGUpIHtcbiAgaWYgKGl0ZW0uZGlzYWJsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gdXNpbmcgYXR0cmlidXRlIGludGVudGlvbmFsbHlcbiAgaWYgKHNlbGVjdGFibGUpIHtcbiAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShcInRhYmluZGV4XCIpO1xuICB9XG4gIGVsc2Uge1xuICAgIGl0ZW0uc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCItMVwiKTtcbiAgfVxufVxuYXN5bmMgZnVuY3Rpb24gc2V0Rm9jdXMoZm9jdXNJZCkge1xuICBpZiAodGhpcy5maWx0ZXJFbmFibGVkICYmIGZvY3VzSWQgPT09IFwiZmlsdGVyXCIpIHtcbiAgICBhd2FpdCBmb2N1c0VsZW1lbnQodGhpcy5maWx0ZXJFbCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHsgaXRlbXMsIG11bHRpcGxlLCBzZWxlY3Rpb25Gb2xsb3dzRm9jdXMgfSA9IHRoaXM7XG4gIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKG11bHRpcGxlKSB7XG4gICAgcmV0dXJuIGZpbHRlck91dERpc2FibGVkKGl0ZW1zKVswXT8uc2V0Rm9jdXMoKTtcbiAgfVxuICBjb25zdCBmaWx0ZXJlZCA9IGZpbHRlck91dERpc2FibGVkKGl0ZW1zKTtcbiAgY29uc3QgZm9jdXNUYXJnZXQgPSBmaWx0ZXJlZC5maW5kKChpdGVtKSA9PiBpdGVtLnNlbGVjdGVkKSB8fCBmaWx0ZXJlZFswXTtcbiAgaWYgKHNlbGVjdGlvbkZvbGxvd3NGb2N1cyAmJiBmb2N1c1RhcmdldCkge1xuICAgIGZvY3VzVGFyZ2V0LnNlbGVjdGVkID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZm9jdXNUYXJnZXQuc2V0Rm9jdXMoKTtcbn1cbmZ1bmN0aW9uIHNldFVwSXRlbXModGFnTmFtZSkge1xuICB0aGlzLml0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3JBbGwodGFnTmFtZSkpO1xuICBsZXQgaGFzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgY29uc3QgeyBpdGVtcyB9ID0gdGhpcztcbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uaWNvbiA9IHRoaXMuZ2V0SWNvblR5cGUoKTtcbiAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHtcbiAgICAgIGl0ZW0uZGVzZWxlY3REaXNhYmxlZCA9IHRydWU7XG4gICAgICB0b2dnbGVTaW5nbGVTZWxlY3RJdGVtVGFiYmluZyhpdGVtLCBmYWxzZSk7XG4gICAgfVxuICAgIGlmIChpdGVtLnNlbGVjdGVkKSB7XG4gICAgICBoYXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICB0b2dnbGVTaW5nbGVTZWxlY3RJdGVtVGFiYmluZyhpdGVtLCB0cnVlKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc2V0KGl0ZW0udmFsdWUsIGl0ZW0pO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IFtmaXJzdF0gPSBpdGVtcztcbiAgaWYgKCFoYXNTZWxlY3RlZCAmJiBmaXJzdCAmJiAhZmlyc3QuZGlzYWJsZWQpIHtcbiAgICB0b2dnbGVTaW5nbGVTZWxlY3RJdGVtVGFiYmluZyhmaXJzdCwgdHJ1ZSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGRlc2VsZWN0UmVtb3ZlZEl0ZW1zKCkge1xuICBjb25zdCBzZWxlY3RlZFZhbHVlcyA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXM7XG4gIGNvbnN0IGl0ZW1WYWx1ZXMgPSB0aGlzLml0ZW1zLm1hcCgoeyB2YWx1ZSB9KSA9PiB2YWx1ZSk7XG4gIHNlbGVjdGVkVmFsdWVzLmZvckVhY2goKHNlbGVjdGVkSXRlbSkgPT4ge1xuICAgIGlmICghaXRlbVZhbHVlcy5pbmNsdWRlcyhzZWxlY3RlZEl0ZW0udmFsdWUpKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzLmRlbGV0ZShzZWxlY3RlZEl0ZW0udmFsdWUpO1xuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBkZXNlbGVjdFNpYmxpbmdJdGVtcyhpdGVtKSB7XG4gIHRoaXMuaXRlbXMuZm9yRWFjaCgoY3VycmVudEl0ZW0pID0+IHtcbiAgICBpZiAoY3VycmVudEl0ZW0udmFsdWUgIT09IGl0ZW0udmFsdWUpIHtcbiAgICAgIGN1cnJlbnRJdGVtLnRvZ2dsZVNlbGVjdGVkKGZhbHNlKTtcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmFsdWVzLmhhcyhjdXJyZW50SXRlbS52YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5kZWxldGUoY3VycmVudEl0ZW0udmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBzZWxlY3RTaWJsaW5ncyhpdGVtLCBkZXNlbGVjdCA9IGZhbHNlKSB7XG4gIGlmICghdGhpcy5sYXN0U2VsZWN0ZWRJdGVtKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHsgaXRlbXMgfSA9IHRoaXM7XG4gIGNvbnN0IHN0YXJ0ID0gaXRlbXMuZmluZEluZGV4KChjdXJyZW50SXRlbSkgPT4ge1xuICAgIHJldHVybiBjdXJyZW50SXRlbS52YWx1ZSA9PT0gdGhpcy5sYXN0U2VsZWN0ZWRJdGVtLnZhbHVlO1xuICB9KTtcbiAgY29uc3QgZW5kID0gaXRlbXMuZmluZEluZGV4KChjdXJyZW50SXRlbSkgPT4ge1xuICAgIHJldHVybiBjdXJyZW50SXRlbS52YWx1ZSA9PT0gaXRlbS52YWx1ZTtcbiAgfSk7XG4gIGl0ZW1zLnNsaWNlKE1hdGgubWluKHN0YXJ0LCBlbmQpLCBNYXRoLm1heChzdGFydCwgZW5kKSkuZm9yRWFjaCgoY3VycmVudEl0ZW0pID0+IHtcbiAgICBjdXJyZW50SXRlbS50b2dnbGVTZWxlY3RlZCghZGVzZWxlY3QpO1xuICAgIGlmICghZGVzZWxlY3QpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc2V0KGN1cnJlbnRJdGVtLnZhbHVlLCBjdXJyZW50SXRlbSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5kZWxldGUoY3VycmVudEl0ZW0udmFsdWUpO1xuICAgIH1cbiAgfSk7XG59XG5sZXQgZ3JvdXBzO1xuZnVuY3Rpb24gaGFuZGxlRmlsdGVyKGVtaXQgPSBmYWxzZSkge1xuICBjb25zdCB7IGZpbHRlcmVkRGF0YSwgZmlsdGVyVGV4dCB9ID0gdGhpcztcbiAgY29uc3QgdmFsdWVzID0gZmlsdGVyZWREYXRhLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gIGxldCBoYXNTZWxlY3RlZE1hdGNoID0gZmFsc2U7XG4gIGlmICghZ3JvdXBzKSB7XG4gICAgZ3JvdXBzID0gbmV3IFNldCgpO1xuICB9XG4gIGNvbnN0IG1hdGNoZWRJdGVtcyA9IHRoaXMuaXRlbXM/LmZpbHRlcigoaXRlbSkgPT4ge1xuICAgIGNvbnN0IHBhcmVudCA9IGl0ZW0ucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBncm91cGVkID0gcGFyZW50Lm1hdGNoZXMoXCJjYWxjaXRlLXBpY2stbGlzdC1ncm91cFwiKTtcbiAgICBpZiAoZ3JvdXBlZCkge1xuICAgICAgZ3JvdXBzLmFkZChwYXJlbnQpO1xuICAgIH1cbiAgICBjb25zdCBtYXRjaGVzID0gZmlsdGVyVGV4dCA/IHZhbHVlcy5pbmNsdWRlcyhpdGVtLnZhbHVlKSA6IHRydWU7XG4gICAgaXRlbS5oaWRkZW4gPSAhbWF0Y2hlcztcbiAgICBpZiAoIWhhc1NlbGVjdGVkTWF0Y2gpIHtcbiAgICAgIGhhc1NlbGVjdGVkTWF0Y2ggPSBtYXRjaGVzICYmIGl0ZW0uc2VsZWN0ZWQ7XG4gICAgfVxuICAgIHJldHVybiBtYXRjaGVzO1xuICB9KSB8fCBbXTtcbiAgZ3JvdXBzLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgY29uc3QgaGFzQXRMZWFzdE9uZU1hdGNoID0gbWF0Y2hlZEl0ZW1zLnNvbWUoKGl0ZW0pID0+IGdyb3VwLmNvbnRhaW5zKGl0ZW0pKTtcbiAgICBncm91cC5oaWRkZW4gPSAhaGFzQXRMZWFzdE9uZU1hdGNoO1xuICAgIGlmICghaGFzQXRMZWFzdE9uZU1hdGNoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHBhcmVudEl0ZW0gPSBnZXRTbG90dGVkKGdyb3VwLCBcInBhcmVudC1pdGVtXCIpO1xuICAgIGlmIChwYXJlbnRJdGVtKSB7XG4gICAgICBwYXJlbnRJdGVtLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgaWYgKG1hdGNoZWRJdGVtcy5pbmNsdWRlcyhwYXJlbnRJdGVtKSkge1xuICAgICAgICBBcnJheS5mcm9tKGdyb3VwLmNoaWxkcmVuKS5mb3JFYWNoKChjaGlsZCkgPT4gKGNoaWxkLmhpZGRlbiA9IGZhbHNlKSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgZ3JvdXBzLmNsZWFyKCk7XG4gIGlmIChtYXRjaGVkSXRlbXMubGVuZ3RoID4gMCAmJiAhaGFzU2VsZWN0ZWRNYXRjaCAmJiAhdGhpcy5tdWx0aXBsZSkge1xuICAgIHRvZ2dsZVNpbmdsZVNlbGVjdEl0ZW1UYWJiaW5nKG1hdGNoZWRJdGVtc1swXSwgdHJ1ZSk7XG4gIH1cbiAgdGhpcy5zZXRGaWx0ZXJlZEl0ZW1zKG1hdGNoZWRJdGVtcyk7XG4gIGlmIChlbWl0KSB7XG4gICAgdGhpcy5lbWl0Q2FsY2l0ZUxpc3RGaWx0ZXIoKTtcbiAgfVxufVxuZnVuY3Rpb24gaGFuZGxlSW5pdGlhbEZpbHRlcigpIHtcbiAgY29uc3QgZmlsdGVyZWRJdGVtcyA9IHRoaXMuZmlsdGVyRWw/LmZpbHRlcmVkSXRlbXM7XG4gIGlmIChmaWx0ZXJlZEl0ZW1zKSB7XG4gICAgdGhpcy5maWx0ZXJlZERhdGEgPSBmaWx0ZXJlZEl0ZW1zO1xuICB9XG4gIHRoaXMuaGFuZGxlRmlsdGVyKCk7XG59XG5mdW5jdGlvbiBoYW5kbGVGaWx0ZXJFdmVudChldmVudCkge1xuICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgY29uc3QgeyBmaWx0ZXJlZEl0ZW1zLCB2YWx1ZSB9ID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgdGhpcy5maWx0ZXJUZXh0ID0gdmFsdWU7XG4gIHRoaXMuZmlsdGVyZWREYXRhID0gZmlsdGVyZWRJdGVtcztcbiAgdGhpcy5oYW5kbGVGaWx0ZXIodHJ1ZSk7XG59XG5mdW5jdGlvbiBnZXRJdGVtRGF0YSgpIHtcbiAgcmV0dXJuIHRoaXMuaXRlbXMubWFwKChpdGVtKSA9PiAoe1xuICAgIGxhYmVsOiBpdGVtLmxhYmVsLFxuICAgIGRlc2NyaXB0aW9uOiBpdGVtLmRlc2NyaXB0aW9uLFxuICAgIG1ldGFkYXRhOiBpdGVtLm1ldGFkYXRhLFxuICAgIHZhbHVlOiBpdGVtLnZhbHVlLFxuICB9KSk7XG59XG5cbmNvbnN0IExpc3QgPSAoeyBwcm9wczogeyBkaXNhYmxlZCwgbG9hZGluZywgZmlsdGVyRW5hYmxlZCwgZGF0YUZvckZpbHRlciwgaGFuZGxlRmlsdGVyRXZlbnQsIGZpbHRlclBsYWNlaG9sZGVyLCBmaWx0ZXJUZXh0LCBzZXRGaWx0ZXJFbCwgZHJhZ0VuYWJsZWQsIHN0b3JlQXNzaXN0aXZlRWwsIH0sIC4uLnJlc3QgfSkgPT4ge1xuICBjb25zdCBkZWZhdWx0U2xvdCA9IGgoXCJzbG90XCIsIG51bGwpO1xuICByZXR1cm4gKGgoSG9zdCwgeyBcImFyaWEtYnVzeVwiOiB0b0FyaWFCb29sZWFuKGxvYWRpbmcpLCByb2xlOiBcIm1lbnVcIiwgLi4ucmVzdCB9LFxuICAgIGgoXCJzZWN0aW9uXCIsIG51bGwsXG4gICAgICBkcmFnRW5hYmxlZCA/IChoKFwic3BhblwiLCB7IFwiYXJpYS1saXZlXCI6IFwiYXNzZXJ0aXZlXCIsIGNsYXNzOiBcImFzc2lzdGl2ZS10ZXh0XCIsIFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgICByZWY6IHN0b3JlQXNzaXN0aXZlRWwgfSkpIDogbnVsbCxcbiAgICAgIGgoXCJoZWFkZXJcIiwgeyBjbGFzczogeyBbQ1NTLnN0aWNreV06IHRydWUgfSB9LFxuICAgICAgICBmaWx0ZXJFbmFibGVkID8gKGgoXCJjYWxjaXRlLWZpbHRlclwiLCB7IFwiYXJpYS1sYWJlbFwiOiBmaWx0ZXJQbGFjZWhvbGRlciwgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgZGlzYWJsZWQsIGl0ZW1zOiBkYXRhRm9yRmlsdGVyLCBvbkNhbGNpdGVGaWx0ZXJDaGFuZ2U6IGhhbmRsZUZpbHRlckV2ZW50LCBwbGFjZWhvbGRlcjogZmlsdGVyUGxhY2Vob2xkZXIsIHZhbHVlOiBmaWx0ZXJUZXh0LCBcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgICAgIHJlZjogc2V0RmlsdGVyRWwgfSkpIDogbnVsbCxcbiAgICAgICAgaChcInNsb3RcIiwgeyBuYW1lOiBTTE9UUyQxLm1lbnVBY3Rpb25zIH0pKSxcbiAgICAgIGxvYWRpbmcgPyBoKFwiY2FsY2l0ZS1zY3JpbVwiLCB7IGxvYWRpbmc6IGxvYWRpbmcgfSkgOiBudWxsLFxuICAgICAgZGVmYXVsdFNsb3QpKSk7XG59O1xuXG5leHBvcnQgeyBMaXN0IGFzIEwsIGRlc2VsZWN0U2libGluZ0l0ZW1zIGFzIGEsIGhhbmRsZUZpbHRlckV2ZW50IGFzIGIsIGluaXRpYWxpemVPYnNlcnZlciBhcyBjLCBkZXNlbGVjdFJlbW92ZWRJdGVtcyBhcyBkLCBjbGVhblVwT2JzZXJ2ZXIgYXMgZSwgaGFuZGxlSW5pdGlhbEZpbHRlciBhcyBmLCBnZXRJdGVtRGF0YSBhcyBnLCBoYW5kbGVGaWx0ZXIgYXMgaCwgaW5pdGlhbGl6ZSBhcyBpLCBjYWxjaXRlTGlzdEl0ZW1DaGFuZ2VIYW5kbGVyIGFzIGosIGtleURvd25IYW5kbGVyIGFzIGssIGNhbGNpdGVJbnRlcm5hbExpc3RJdGVtVmFsdWVDaGFuZ2VIYW5kbGVyIGFzIGwsIG11dGF0aW9uT2JzZXJ2ZXJDYWxsYmFjayBhcyBtLCBjYWxjaXRlTGlzdEZvY3VzT3V0SGFuZGxlciBhcyBuLCBzZXRVcEl0ZW1zIGFzIG8sIHNldEZvY3VzIGFzIHAsIGdldEl0ZW1JbmRleCBhcyBxLCByZW1vdmVJdGVtIGFzIHIsIHNlbGVjdFNpYmxpbmdzIGFzIHMsIG1vdmVJdGVtSW5kZXggYXMgdCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9